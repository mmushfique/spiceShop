<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords"
        content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>Dreams Pos admin template</title>

    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.png">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <link rel="stylesheet" href="assets/css/animate.css">

    <link rel="stylesheet" href="assets/plugins/owlcarousel/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/plugins/owlcarousel/owl.theme.default.min.css">

    <link rel="stylesheet" href="assets/plugins/select2/css/select2.min.css">

    <link rel="stylesheet" href="assets/css/bootstrap-datetimepicker.min.css">

    <link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">

    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div id="global-loader">
        <div class="whirly-loader"> </div>
    </div>
    <div class="main-wrappers">
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <div class="header" style="background-color: aqua;">
            <div class="header-left border-0 ">
                <a href="index.html" class="logo">
                    <img src="assets/img/logo.png" alt="">
                </a>
                <a href="index.html" class="logo-small">
                    <img src="assets/img/logo-small.png" alt="">
                </a>
            </div>


            <ul class="nav user-menu">

                <li class="nav-item">
                    <div class="top-nav-search">
                        <a href="javascript:void(0);" class="responsive-search">
                            <i class="fa fa-search"></i>
                        </a>
                        <form action="#">
                            <div class="searchinputs">
                                <input type="text" placeholder="Search Here ...">
                                <div class="search-addon">
                                    <span><img src="assets/img/icons/closes.svg" alt="img"></span>
                                </div>
                            </div>
                            <a class="btn" id="searchdiv"><img src="assets/img/icons/search.svg" alt="img"></a>
                        </form>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
                        <img src="assets/img/icons/notification-bing.svg" alt="img"> <span
                            class="badge rounded-pill">4</span>
                    </a>
                    <div class="dropdown-menu notifications">
                        <div class="topnav-dropdown-header">
                            <span class="notification-title">Notifications</span>
                            <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
                        </div>
                        <div class="noti-content">
                            <ul class="notification-list">
                                <li class="notification-message">
                                    <a href="activities.html">
                                        <div class="media d-flex">
                                            <span class="avatar flex-shrink-0">
                                                <img alt="" src="assets/img/profiles/avatar-13.jpg">
                                            </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details"><span class="noti-title">Bernardo Galaviz</span>
                                                    added new task <span class="noti-title">Private chat module</span>
                                                </p>
                                                <p class="noti-time"><span class="notification-time">2 days ago</span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="topnav-dropdown-footer">
                            <a href="activities.html">View all Notifications</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item dropdown has-arrow main-drop">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
                        <span class="user-img"><img src="assets/img/profiles/avator1.jpg" alt="">
                            <span class="status online"></span></span>
                    </a>
                    <div class="dropdown-menu menu-drop-user">
                        <div class="profilename">
                            <div class="profileset">
                                <span class="user-img"><img src="assets/img/profiles/avator1.jpg" alt="">
                                    <span class="status online"></span></span>
                                <div class="profilesets">
                                    <h6>John Doe</h6>
                                    <h5>Admin</h5>
                                </div>
                            </div>
                            <hr class="m-0">
                            <a class="dropdown-item" href="profile.html"> <svg xmlns="http://www.w3.org/2000/svg"
                                    width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                    class="feather feather-user me-2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg> My Profile</a>
                            <a class="dropdown-item" href="generalsettings.html"><svg xmlns="http://www.w3.org/2000/svg"
                                    width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                    class="feather feather-settings me-2">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path
                                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                    </path>
                                </svg>Settings</a>
                            <hr class="m-0">
                            <a class="dropdown-item logout pb-0" href="signin.html"><img
                                    src="assets/img/icons/log-out.svg" class="me-2" alt="img">Logout</a>
                        </div>
                    </div>
                </li>
            </ul>


            <div class="dropdown mobile-user-menu">
                <a href="javascript:void(0);" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="profile.html">My Profile</a>
                    <a class="dropdown-item" href="generalsettings.html">Settings</a>
                    <a class="dropdown-item" href="signin.html">Logout</a>
                </div>
            </div>

        </div>

        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->

        <div class="page-wrapper ms-0">
            <div class="content">
                <div class="row">
                    <div class="col-lg-4 col-sm-12 tabs_wrapper">
                        <div class="page-header ">
                            <div class="page-title">
                                <h4>Categories</h4>
                                <h6>Manage your sales</h6>
                            </div>
                        </div>

                        <div class="row" id="productContainer">
                        </div>
                    </div>

                    <div class="col-lg-8 col-sm-12 ">
                        <div class="order-list">
                            <div class="orderid">
                                <h4>Order List</h4>
                            </div>
                        </div>
                        <div class="card card-order">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12">
                                        <a href="addsupplier.html" class="btn btn-adds"><i
                                                class="fa fa-plus me-2"></i>Add Supplier</a>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="select-split ">
                                            <div class="select-group w-100">
                                                <select class="select">
                                                    <option>Walk-in Supplier</option>
                                                    <option>Aaaa</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-body pt-0">
                                <div class="totalitem">
                                    <h4>Total items : 4</h4>
                                    <a href="javascript:void(0);">Clear all</a>
                                </div>
                                <div class="product-table" id="productTable">
                                    <ul class="product-lists">
                                        <li>
                                            <div class="productimg">
                                                <div class="productimgs">
                                                    <img src="" alt="img">
                                                    <h4>Product</h4>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Price per unit</h4>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Quantity</h4>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Qty after dropped</h4>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Price</h4>
                                            </div>
                                        </li>
                                        <li><a class="confirm-text" href="javascript:void(0);"><img
                                                    src="assets/img/icons/delete-2.svg" alt="img"></a></li>
                                    </ul>
                                    <style>
                                        .product-lists li {
                                            border-right: 1px solid #ccc;
                                            /* Add a right border to each li element */
                                            padding-right: 10px;
                                            /* Add some padding to create space between items */
                                            margin-right: 10px;
                                            /* Add some margin to create space between items */
                                        }

                                        /* Remove the right border from the last li element */
                                        .product-lists li:last-child {
                                            border-right: none;
                                        }
                                    </style>
                                </div>
                            </div>

                            <div class="card-body pt-0 pb-2">
                                <div class="setvalue">
                                    <ul>
                                        <li class="total-value">
                                            <h5>Total </h5>
                                            <h6 id="total">00.00</h6>
                                        </li>
                                    </ul>
                                </div>
                                <div class="setvaluecash">
                                    <ul>
                                        <li>
                                            <a href="javascript:void(0);" class="paymentmethod">
                                                <img src="assets/img/icons/cash.svg" alt="img" class="me-2">
                                                Cash
                                            </a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);" class="paymentmethod">
                                                <img src="assets/img/icons/debitcard.svg" alt="img" class="me-2">
                                                Cheque
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="btn-totallabel" id="checkoutTotal">
                                    <h5>Checkout</h5>
                                    <h6 id="total2">00.00</h6>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- Modal HTML -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-content"></div>
        </div>
    </div>


    <!-- ------------------------------------invoice modal------------------ ------------------------------------>
    <!-- ------------------------------------------------------------------------------------------------------- -->
    <div class="modal fade" id="create" tabindex="-1" aria-labelledby="create" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Product-rubber</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-6 col-sm-12 col-12">
                            <div class="form-group">
                                <label>Price per unit</label>
                                <input type="number" step=".01" id="pricePerUnit">
                            </div>
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" step=".01" id="quantity">
                            </div>
                            <div class="form-group">
                                <label>Drop quantity</label>
                                <input type="number" step=".01" id="dropQty">
                            </div>
                            <input type="hidden" id="productIdInput" name="productId">
                            <input type="hidden" id="productNameInput" name="productName">
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <a class="btn btn-submit me-2" onclick="addData()">Submit</a>
                        <a class="btn btn-cancel" data-bs-dismiss="modal">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ------------------------------------invoice modal----------------------------------------->
    <!-- ------------------------------------------------------------------------------------------------------- -->



    <script>

        ///////////// Make a GET request to retrieve products///////////////////////////////////
        window.onload = function () {
            axios.get('/api/product')
                .then(response => {
                    // Assuming the response.data is an array of products
                    const products = response.data;   
                    // Call a function to populate products with the retrieved data
                    addProductsToPage(products);
                })
                .catch(error => {
                    modalPop('Error fetching products:', error)
                });

            // const products =
            //     [
            //         { id: 1, name: "Rubber", quantity: 5.0 },
            //         { id: 1, name: "Rubber", quantity: 5.0 }
            //         // Add more products here
            //     ];
            addProductsToPage(products);


        }

        // Function to add products to the HTML structure
        function addProductsToPage(products) {
            const productContainer = document.getElementById("productContainer");

            // Loop through your product data and create HTML elements
            products.forEach(product => {
                const productDiv = document.createElement("div");
                productDiv.classList.add("col-lg-4", "col-sm-2", "d-flex");

                const productLink = document.createElement("a");
                productLink.href = "javascript:void(0);";
                productLink.dataset.bsToggle = "modal";
                productLink.dataset.bsTarget = "#create";

                // Add click event listener to the productLink to handle product selection
                productLink.addEventListener("click", function () {
                    // Set the product ID and name as hidden input values in the form
                    const productIdInput = document.getElementById("productIdInput");
                    const productNameInput = document.getElementById("productNameInput");
                    productIdInput.value = product.id;
                    productNameInput.value = product.name;
                });


                const productSet = document.createElement("div");
                productSet.classList.add("productset", "flex-fill", "active");

                const productSetImg = document.createElement("div");
                productSetImg.classList.add("productsetimg");

                const productImage = document.createElement("img");
                productImage.id = "imgDisplayed"
                productImage.src = product.imageUrl;//product.image;
                productImage.alt = "img";

                const productSetContent = document.createElement("div");
                productSetContent.classList.add("productsetcontent");

                const productName = document.createElement("h4");
                productName.textContent = product.name;

                // Append elements to create the product structure
                productSetImg.appendChild(productImage);
                productSetContent.appendChild(productName);
                productSet.appendChild(productSetImg);
                productSet.appendChild(productSetContent);
                productLink.appendChild(productSet);
                productDiv.appendChild(productLink);

                // Append the productDiv to the productContainer
                productContainer.appendChild(productDiv);
            });
        }
        /////// END ////// Make a GET request to retrieve products///////////////////////////////////

        //////////////////////////function to add data to table from create modal/////////////////////////////////////////
        function addData() {
            // Get the input values
            const pricePerUnit = document.querySelector('#pricePerUnit').value;
            const quantity = document.querySelector('#quantity').value;
            const dropQty = document.querySelector('#dropQty').value;
            const price = pricePerUnit * (quantity - dropQty);
            const id = document.querySelector('#productIdInput').value;
            const name = document.querySelector('#productNameInput').value;
            const imgElementDisplayed = document.querySelector('#imgDisplayed');
            const imgUrl = imgElementDisplayed.src;

            // Create a new <ul> element for the record
            const ulElement = document.createElement('ul');
            ulElement.classList.add('product-lists');

            // Create <li> elements for the record data
            const liElements = [];

            // Create the first column with image and product name
            const liImageContainer = document.createElement('li');
            liImageContainer.classList.add('productimg');

            const divProductImages = document.createElement('div');
            divProductImages.classList.add('productimgs');

            const imgElement = document.createElement('img');
            imgElement.src = imgUrl;
            imgElement.alt = 'img';

            divProductImages.appendChild(imgElement);
            liImageContainer.appendChild(divProductImages);

            // Here, we'll create the <h4> element for the product name and add it to divProductImages
            const productName = document.createElement('h4');
            const productId = document.createElement('h4');
            productId.style.display = 'none'
            productId.textContent = id;
            productName.textContent = name;
            divProductImages.appendChild(productName);
            divProductImages.appendChild(productId)

            liElements.push(liImageContainer);

            // Add the rest of the data to the <li> elements
            for (let i = 0; i < 4; i++) {
                const liElement = document.createElement('li');
                // Customize this part to add specific data to each <li>
                switch (i) {
                    case 0:
                        liElement.textContent = pricePerUnit;
                        break;
                    case 1:
                        liElement.textContent = quantity;
                        break;
                    case 2:
                        liElement.textContent = quantity - dropQty;
                        break;
                    case 3:
                        liElement.textContent = price;
                        break;
                    default:
                        break;
                }
                liElements.push(liElement);
            }



            // Create the delete button for the last column
            const deleteButton = document.createElement('a');
            deleteButton.classList.add('confirm-text');
            deleteButton.href = 'javascript:void(0);';
            // Customize this part to add your delete button content
            deleteButton.innerHTML = '<img src="assets/img/icons/delete-2.svg" alt="img">';
            const liDeleteButton = document.createElement('li');
            liDeleteButton.appendChild(deleteButton);
            liElements.push(liDeleteButton);

            // Append the <li> elements to the <ul>
            liElements.forEach(li => ulElement.appendChild(li));

            // Append the new record to the product table
            const productTable = document.querySelector('#productTable');
            productTable.appendChild(ulElement);

            // Clear the input fields
            document.querySelector('#pricePerUnit').value = '';
            document.querySelector('#quantity').value = '';
            document.querySelector('#dropQty').value = '';

            // Calculate the total sum of prices
            const totalLabel = document.getElementById('total');
            const totalLabel2 = document.getElementById('total2');
            const currentTotal = parseFloat(totalLabel.textContent.replace('Rs', '')) || 0; // Get the current total, remove 'Rs' and convert to float
            const newTotal = currentTotal + price; // Calculate the new total

            // Update the total label
            totalLabel.textContent = newTotal.toFixed(2) + 'Rs';
            totalLabel2.textContent = newTotal.toFixed(2) + 'Rs';

            // Add a click event listener to the delete button
            deleteButton.addEventListener('click', function () {
                // Find the parent <ul> element
                const ulElement = this.closest('.product-lists');

                // Check if the parent <ul> element exists
                if (ulElement) {
                    // Find the price element (5th <li>) within the clicked row
                    const priceElement = ulElement.querySelectorAll('li')[4];
                    const priceToRemove = parseFloat(priceElement.textContent);

                    const currentTotal2 = parseFloat(totalLabel.textContent.replace('Rs', '')) || 0; // Get the current total, remove 'Rs' and convert to float
                    const newTotal2 = currentTotal2 - priceToRemove; // Calculate the new total

                    // Update the total label
                    totalLabel.textContent = newTotal2.toFixed(2) + 'Rs';
                    totalLabel2.textContent = newTotal2.toFixed(2) + 'Rs';

                    // Remove the <ul> element from the table
                    ulElement.remove();
                }
            });

            // Close the modal
            const createModal = document.getElementById('create');
            const modal = bootstrap.Modal.getInstance(createModal);
            if (modal) {
                modal.hide();
            }
        }
        ///// END ////////////function to add data to table from create modal/////////////////////////////////////////

        ////////////////Send the records from table to server///////////////////////////

        // Select the "Checkout" button by its id
        const checkoutButton = document.getElementById('checkoutTotal');

        // Add a click event listener to the button
        // Add a click event listener to the button
        checkoutButton.addEventListener('click', function () {
            const total = document.querySelector('#total');

            // Create the invoice object
            const invoice = {  
                "total": parseFloat(total.textContent.replace('Rs', '')),
                "tradeType":"SOLD"
            };

            // Send the invoice creation request
            axios.post('/api/invoice', invoice)
                .then(invoiceResponse => {
                    // Handle the response from the server if needed
                    // Get the newly created invoice's ID
                    const invoiceId = invoiceResponse.data.id;

                    // Get all the records in the table
                    const productTableLists = document.querySelectorAll('.product-lists');

                    // Create an array to store the records
                    const transactions = [];

                    // Loop through each record in the table
                    for (let i = 1; i < productTableLists.length; i++) {
                        const table = productTableLists[i];
                        const record = {
                            "pricePerUnit": parseFloat(table.querySelectorAll('li')[1].textContent),
                            "qty": parseFloat(table.querySelectorAll('li')[2].textContent),
                            "qtyAfterDropped": parseFloat(table.querySelectorAll('li')[3].textContent),
                            "price": parseFloat(table.querySelectorAll('li')[4].textContent),
                            "dried": false,
                            "dryPercent": 0.5,
                            "invoice": {
                                "id": invoiceId // Use the invoice ID obtained earlier
                            },
                            "product": {
                                "id": table.querySelectorAll('h4')[1].textContent,
                                "name": table.querySelectorAll('h4')[0].textContent
                            }
                        };

                        transactions.push(record);
                    }
                    console.log('transactions created:', transactions);
                    // Send the records to your server using Axios
                    axios.post('/api/transaction/sale', transactions)
                        .then(response => {
                            // Handle the response from the server if needed
                            modalPop('Transaction successful');
                        })
                        .catch(error => {
                            // Handle any errors that occur during the POST request
                            modalPop('Error sending transaction data:', error);
                        });

                    // ... (clear input fields and other logic) ..
                    // Clear the input fields or perform any other necessary actions
                    // For example, clear the product table
                    const productTable = document.querySelector('#productTable');
                    productTable.innerHTML = '';
                    // Reset the total value
                    document.getElementById('checkoutTotal').textContent = '0.00';
                })
                .catch(error => {
                    // Handle any errors that occur during the invoice creation
                    modalPop('Error creating invoice:', error);
                });
        });


        ///// END ///////////Send the records from table to server///////////////////////////

        //modal pupulate code
        function modalPop(value) {
            const modal = document.getElementById('resultModal');
            // Close the modal
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = '<p>' + value + '</p>';
            // Display the modal
            modal.style.display = 'block';

            // Close the modal when the user clicks the close button
            const closeBtn = document.querySelector('.close');
            closeBtn.onclick = function () {
                modal.style.display = 'none';
            };
            return;
        }
    </script>
    <script src="assets/js/axios.js"></script>

    <script src="assets/js/jquery-3.6.0.min.js"></script>

    <script src="assets/js/feather.min.js"></script>

    <script src="assets/js/jquery.slimscroll.min.js"></script>

    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/dataTables.bootstrap4.min.js"></script>

    <script src="assets/plugins/select2/js/select2.min.js"></script>

    <script src="assets/plugins/owlcarousel/owl.carousel.min.js"></script>

    <script src="assets/plugins/sweetalert/sweetalert2.all.min.js"></script>
    <script src="assets/plugins/sweetalert/sweetalerts.min.js"></script>

    <script src="assets/js/script.js"></script>
</body>

</html>